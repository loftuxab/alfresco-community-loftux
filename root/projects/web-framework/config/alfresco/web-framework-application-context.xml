<?xml version='1.0' encoding='UTF-8'?>
<!DOCTYPE beans PUBLIC '-//SPRING//DTD BEAN//EN' 'http://www.springframework.org/dtd/spring-beans-2.0.dtd'>

<beans>

   <!--                       -->
   <!-- Configuration Service -->
   <!--                       -->

   <bean id="webframework.configsource"
         class="org.alfresco.config.source.UrlConfigSource">
      <constructor-arg>
         <list>
            <!-- Web Script Framework -->
            <value>classpath:alfresco/webscript-framework-config.xml</value>
            <value>classpath:alfresco/web-extension/webscript-framework-config-custom.xml</value>
            <value>jar:*!/META-INF/webscript-framework-config-custom.xml</value>
            
            <!--  Start TEST dependencies -->
            <!--  These is included because some of the tests require it  -->
            <!--  These should be removed -->
            <value>classpath:alfresco/webscript-framework-config-test.xml</value>
            <!--  End TEST dependencies -->
            
            <!-- Web Framework -->
            <value>classpath:alfresco/web-framework-config.xml</value>
            <value>classpath:alfresco/web-framework-config-remote.xml</value>
            <value>classpath:alfresco/web-framework-config-commons.xml</value>
            <value>classpath:alfresco/web-framework-config-application.xml</value>
            <value>classpath:alfresco/web-extension/web-framework-config-custom.xml</value>
            <value>jar:*!/META-INF/web-framework-config-custom.xml</value>
            
         </list>
      </constructor-arg>
   </bean>

   <!-- override the web config bean -->
   <bean id="web.config"
         class="org.alfresco.config.xml.XMLConfigService" init-method="init">
      <constructor-arg>
         <ref bean="webframework.configsource" />
      </constructor-arg>
   </bean>
   
   
   <!--                                                     -->
   <!-- Configuration of Abstract Store Implementations     -->
   <!--                                                     -->

   <!-- ClassPath Store Abstract -->
   <bean id="webframework.classpathstore" class="org.alfresco.web.scripts.ClassPathStore" abstract="true" init-method="init" />   

   <!-- Remote Store Abstract -->
   <bean id="webframework.remotestore" parent="webscripts.remotestore" abstract="true" init-method="init">
      <property name="endpoint">
         <value>alfresco</value>
      </property>
      <property name="api">
         <value>/remotestore</value>
      </property>
      <property name="connectorService" ref="connector.service" />
      <property name="storeContext" ref="webframework.context.remotestore"/>
      <property name="connectorProvider" ref="webframework.connector.provider" />      
   </bean>

   <!--                                                     -->
   <!-- Additional Configuration for Remote Store           -->
   <!--                                                     -->

   <!-- Remote Store Context for Web Framework -->
   <bean id="webframework.context.remotestore" class="org.alfresco.web.framework.WebFrameworkRemoteStoreContext" />

   <!-- Web Framework Connector Provider -->   
   <bean id="webframework.connector.provider" class="org.alfresco.web.framework.WebFrameworkConnectorProvider">
      <property name="connectorService" ref="connector.service" />
   </bean>
   
   
   <!--                                                     -->
   <!-- Configuration of the Web Script Runtime / Container -->
   <!--                                                     -->
   
   <bean id="webframework.store.webscripts" class="org.alfresco.web.scripts.ClassPathStore">
      <property name="mustExist"><value>true</value></property>
      <property name="classPath"><value>alfresco/site-webscripts</value></property>
   </bean>
   
   <bean id="webframework.store.webscripts.custom" class="org.alfresco.web.scripts.ClassPathStore">
      <property name="mustExist"><value>false</value></property>
      <property name="classPath"><value>alfresco/web-extension/site-webscripts</value></property>
   </bean>
   
   <bean id="webframework.remotestore.webscripts" parent="webframework.remotestore">
      <property name="path"><value>alfresco/site-webscripts</value></property>
   </bean>
   
   <bean id="webframework.searchpath" class="org.alfresco.web.scripts.SearchPath">
      <property name="searchPath">
         <list>
            <!-- <ref bean="webframework.remotestore.webscripts" /> -->
            <ref bean="webframework.store.webscripts.custom" />
            <ref bean="webframework.store.webscripts" />
            <ref bean="webscripts.store" />
         </list>
      </property>
   </bean>
   
   <bean id="webframework.webscripts.templateprocessor" class="org.alfresco.web.scripts.PresentationTemplateProcessor">
      <property name="searchPath" ref="webframework.searchpath" />
      <property name="updateDelay"><value>600</value></property>
      <property name="defaultEncoding"><value>UTF-8</value></property>
   </bean>
   
   <bean id="webframework.webscripts.scriptprocessor" class="org.alfresco.web.scripts.PresentationScriptProcessor">
      <property name="searchPath" ref="webframework.searchpath" />
      <property name="compile"><value>true</value></property>
   </bean>
   
   <bean id="webframework.webscripts.index" class="org.alfresco.web.scripts.JaxRSUriIndex" />
   
   <bean id="webframework.webscripts.container" parent="webscripts.abstractcontainer" class="org.alfresco.web.scripts.LocalWebScriptRuntimeContainer">
      <property name="name"><value>WebFramework</value></property>
      <property name="registry" ref="webframework.webscripts.registry" />
      <property name="searchPath" ref="webframework.searchpath" />
      <property name="templateProcessor" ref="webframework.webscripts.templateprocessor" />
      <property name="scriptProcessor" ref="webframework.webscripts.scriptprocessor" />
      <property name="configService" ref="web.config" />
      <property name="scriptObjects">
         <map merge="true">
            <entry key="remote" value-ref="webframework.script.remote" />
         </map>
      </property>
   </bean>   
   
   <bean id="webframework.webscripts.registry" class="org.alfresco.web.scripts.DeclarativeRegistry">
      <property name="container" ref="webframework.webscripts.container" />
      <property name="uriIndex" ref="webframework.webscripts.index" />
      <property name="searchPath" ref="webframework.searchpath" />
      <property name="defaultWebScript"><value>webscript.default</value></property>
   </bean>
   
   
   <!--                                                    -->
   <!-- Configuration of the FreeMarker Template Processor -->
   <!--                                                    -->
   
   <bean id="webframework.store.templates" class="org.alfresco.web.scripts.ClassPathStore">
      <property name="mustExist"><value>true</value></property>
      <property name="classPath"><value>alfresco/templates</value></property>
   </bean>
   
   <bean id="webframework.store.templates.custom" class="org.alfresco.web.scripts.ClassPathStore">
      <property name="mustExist"><value>false</value></property>
      <property name="classPath"><value>alfresco/web-extension/templates</value></property>
   </bean>
   
   <bean id="webframework.store.system-templates" class="org.alfresco.web.scripts.ClassPathStore">
      <property name="mustExist"><value>true</value></property>
      <property name="classPath"><value>alfresco/system-templates</value></property>
   </bean>
   
   <bean id="webframework.remotestore.templates" parent="webframework.remotestore">
      <property name="path"><value>alfresco/templates</value></property>
   </bean>      
   
   <bean id="webframework.templates.searchpath" class="org.alfresco.web.scripts.SearchPath">
      <property name="searchPath">
         <list>
            <!-- <ref bean="webframework.remotestore.templates" /> -->
            <!-- <ref bean="webframework.remotestore.webscripts" /> -->
            <ref bean="webframework.store.templates.custom" />
            <ref bean="webframework.store.webscripts.custom" />
            <ref bean="webframework.store.templates" />
            <ref bean="webframework.store.webscripts" />
            <ref bean="webframework.store.system-templates" />
         </list>
      </property>
   </bean>

   
   <!--                                              -->
   <!-- Configuration of the WebFramework Processors -->
   <!--                                              -->
   
   <!-- NOTE: do not change the IDs of these Processors - they are referenced by the FrameworkHelper class -->
   
   <bean id="webframework.templateprocessor" class="org.alfresco.web.scripts.PresentationTemplateProcessor">
      <property name="searchPath" ref="webframework.templates.searchpath" />
      <property name="defaultEncoding"><value>UTF-8</value></property>
      <property name="updateDelay"><value>600</value></property>
   </bean>
   
   <bean id="webframework.scriptprocessor" class="org.alfresco.web.scripts.PresentationScriptProcessor">
      <property name="searchPath" ref="webframework.templates.searchpath" />
      <property name="compile"><value>true</value></property>
   </bean>


   <!--                             -->
   <!--  Web Script Implementations -->
   <!--                             -->
 
   <!--  I18N resources and messages Web Script -->
   <bean id="webscript.org.alfresco.web.messages.get" parent="webscript" class="org.alfresco.web.scripts.MessagesWebScript" scope="prototype" />

   <!--  Declarative Site Web Script -->
   <bean id="webscript.site" parent="webscript" class="org.alfresco.web.scripts.DeclarativeSiteWebScript" scope="prototype" />

   <!--  Dynamic Wizard Web Script -->
   <bean id="webscript.wizard" parent="webscript" class="org.alfresco.web.scripts.DeclarativeSiteWizardWebScript" scope="prototype" />


   <!--                           -->
   <!-- Web Script Authenticators -->
   <!--                           -->

   <!-- HTTP Basic Authenticator (Servlet based) -->
   <bean id="webscripts.authenticator.basic" class="org.alfresco.web.scripts.BasicHttpAuthenticatorFactory">
      <property name="connectorService" ref="connector.service" />
      <property name="endpointId" value="alfresco-feed" />
   </bean>

   <!-- HTTP Basic Delegating Authenticator (Servlet based) -->
   <bean id="webscripts.authenticator.delegatingbasic" class="org.alfresco.web.scripts.BasicHttpAuthenticatorFactory">
      <property name="connectorService" ref="connector.service" />
      <property name="endpointId" value="alfresco-feed" />
      <property name="delegate" value="true" />
   </bean>


   <!--                       -->
   <!-- Web Framework Manager -->
   <!--                       -->
   
   <bean id="webframework.manager" class="org.alfresco.web.framework.WebFrameworkManager" init-method="init">
      <property name="configService" ref="web.config" />
   </bean>
   
   
   <!-- Stores containing presets for pre-generated pages and component bindings -->
   <bean id="webframework.classpathstore.presets" class="org.alfresco.web.scripts.ClassPathStore">
      <property name="mustExist"><value>false</value></property>   
      <property name="classPath"><value>alfresco/site-data/presets</value></property>
   </bean>
   
   <bean id="webframework.classpathstore.presets.custom" class="org.alfresco.web.scripts.ClassPathStore">
      <property name="mustExist"><value>false</value></property>
      <property name="classPath"><value>alfresco/web-extension/site-data/presets</value></property>
   </bean>
   
   <bean id="webframework.remotestore.presets" parent="webframework.remotestore">
      <property name="path"><value>alfresco/site-data/presets</value></property>
   </bean>
   
   <bean id="webframework.presets.searchpath" class="org.alfresco.web.scripts.SearchPath">
      <property name="searchPath">
         <list>
            <ref bean="webframework.classpathstore.presets.custom" />
            <ref bean="webframework.classpathstore.presets" />
         </list>
      </property>
   </bean>
   
   
   <!-- Presets manager - should be configured to walk a search path for preset definition files -->
   <bean id="webframework.presets.manager" class="org.alfresco.web.framework.PresetsManager">
      <property name="searchPath" ref="webframework.presets.searchpath" />
      <property name="files">
         <list>
            <value>presets.xml</value>
         </list>
      </property>
   </bean>
   
   
   <!--                                             -->
   <!-- Web Framework Freemarker and JSP processors -->
   <!--                                             -->
   
   <bean id="webframework.processor.webscript" class="org.alfresco.web.scripts.WebScriptProcessor">
      <property name="containerBean" ref="webframework.webscripts.container" />
      <property name="templateProcessor" ref="webframework.templateprocessor" />
      <property name="registry" ref="webframework.webscripts.registry" />
   </bean>
   
   <bean id="webframework.processor.freemarker" class="org.alfresco.web.scripts.FreemarkerProcessor">
      <property name="templateProcessor" ref="webframework.templateprocessor" />
      <property name="scriptProcessor" ref="webframework.scriptprocessor" />
      <property name="templateStore" ref="webframework.store.templates" />
      <property name="scriptObjects">
         <map>
            <entry key="remote" value-ref="webframework.script.remote" />
         </map>
      </property>
   </bean>
   
   <bean id="webframework.processor.jsp" class="org.alfresco.web.framework.render.bean.JSPProcessor" />

   <!-- Web Framework - Model Object Renderers -->
   <bean id="webframework.renderer.chrome" class="org.alfresco.web.framework.render.bean.ChromeRenderer" />
   <bean id="webframework.renderer.component" class="org.alfresco.web.framework.render.bean.ComponentRenderer" />
   <bean id="webframework.renderer.page" class="org.alfresco.web.framework.render.bean.PageRenderer" />
   <bean id="webframework.renderer.region" class="org.alfresco.web.framework.render.bean.RegionRenderer" />   
   <bean id="webframework.renderer.template" class="org.alfresco.web.framework.render.bean.TemplateInstanceRenderer" />
   
   <!-- RendererContext Provider Implementation -->
   <bean id="webframework.rendercontext.provider" class="org.alfresco.web.framework.render.bean.DefaultRenderContextProvider" />
   
   <!-- Declare the Web Framework Script Remote instance to inject Web Framework Connector Provider -->
   <bean id="webframework.script.remote" class="org.alfresco.web.scripts.ScriptRemote">
      <property name="configService" ref="web.config"/>
      <property name="connectorProvider" ref="webframework.connector.provider"/>
   </bean>
   
   
   <!--                                                 -->
   <!-- Import Script and Template Processor Extensions -->
   <!--                                                 -->
   
   <import resource="classpath*:alfresco/web-framework-script-services-context.xml" />
   <import resource="classpath*:alfresco/web-framework-template-services-context.xml" />

</beans>